<link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet"><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poetry Collection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Montserrat", sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            text-align: center;
            padding: 2rem 1rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .cards-grid {
            position: relative;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: absolute;
            overflow: hidden;
            width: calc(33.333% - 1rem);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 16px 16px 0 0;
        }

        .card-icon {
            position: absolute;
            top: 1rem;
            left: 1rem;
            font-size: 1.5rem;
            opacity: 0.7;
            z-index: 2;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            text-align: center;
            margin-top: 2rem;
        }

        .card-content {
            color: #4a5568;
            white-space: pre-line;
        }

        .card-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 0.5rem 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            max-height: 90vh;
            margin: 5vh auto;
            padding: 2rem;
            position: relative;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #e2e8f0;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            cursor: pointer;
            color: #4a5568;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #cbd5e0;
            transform: scale(1.1);
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .modal-text {
            color: #4a5568;
            font-size: 1.1rem;
            line-height: 1.8;
            white-space: pre-line;
        }

        .modal-text img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 1rem 0;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #718096;
            font-size: 1.1rem;
        }

        .error {
            text-align: center;
            padding: 3rem;
            color: #e53e3e;
            font-size: 1.1rem;
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .cards-grid {
                position: relative !important;
                height: auto !important;
            }

            .card {
                position: relative !important;
                width: 100% !important;
                left: 0 !important;
                top: 0 !important;
                margin-bottom: 1rem !important;
            }

            .modal-content {
                margin: 2vh auto;
                max-height: 96vh;
                padding: 1.5rem;
            }

            .modal-title {
                font-size: 1.5rem;
            }
        }

        /* Pastel color classes */
        .color-1 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .color-2 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .color-3 { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); }
        .color-4 { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
        .color-5 { background: linear-gradient(135deg, #fddb92 0%, #d1fdff 100%); }
        .color-6 { background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); }
        .color-7 { background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); }
        .color-8 { background: linear-gradient(135deg, #c7ecee 0%, #ddd6f3 100%); }
        .color-9 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .color-10 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }

        /* Accent colors for card tops */
        .color-1::before { background: #fcb69f; }
        .color-2::before { background: #fed6e3; }
        .color-3::before { background: #fef9d7; }
        .color-4::before { background: #66a6ff; }
        .color-5::before { background: #d1fdff; }
        .color-6::before { background: #a6c1ee; }
        .color-7::before { background: #fab1a0; }
        .color-8::before { background: #ddd6f3; }
        .color-9::before { background: #f5576c; }
        .color-10::before { background: #00f2fe; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Poetry Collection</h1>
        <p>A curated selection of verses and reflections</p>
    </div>

    <div class="container">
        <div id="loading" class="loading">Loading poems...</div>
        <div id="error" class="error" style="display: none;">Failed to load poems. Make sure .txt files exist in /data/ directory.</div>
        <div id="cards-container" class="cards-grid"></div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <h2 id="modal-title" class="modal-title"></h2>
            <div id="modal-text" class="modal-text"></div>
        </div>
    </div>

    <script>
        let poems = [];

        async function loadPoems() {
            try {
                // Get list of txt files from data directory
                const fileList = await getFileList();
                
                for (const filename of fileList) {
                    try {
                        const response = await fetch(`data/${filename}`);
                        if (response.ok) {
                            const text = await response.text();
                            parsePoems(text, filename);
                        }
                    } catch (error) {
                        console.warn(`Failed to load ${filename}:`, error);
                    }
                }
                
                renderCards();
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                console.error('Error loading poems:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }

        async function getFileList() {
            try {
                const manifestResponse = await fetch('data/files.json');
                if (!manifestResponse.ok) {
                    throw new Error('files.json not found');
                }
                const manifest = await manifestResponse.json();
                return manifest.files || [];
            } catch (error) {
                console.error('Error loading files.json:', error);
                return [];
            }
        }

        function parsePoems(text, filename) {
            const sections = text.split('---').filter(section => section.trim());
            
            // If no sections found, treat entire file as one poem
            if (sections.length === 0 && text.trim()) {
                sections.push(text.trim());
            }

            sections.forEach(section => {
                const lines = section.trim().split('\n');
                let title = '';
                let content = '';
                let date = new Date();

                // Extract title - support both formats
                const titleMatch = section.match(/(?:<title>(.*?)<\/title>|title:\s*(.+))/i);
                if (titleMatch) {
                    title = (titleMatch[1] || titleMatch[2]).trim();
                    // Remove title line from content
                    content = section.replace(/(?:<title>.*?<\/title>|title:\s*.+)/i, '').trim();
                } else {
                    // Use filename (without extension) as title if no title found
                    title = filename.replace(/\.txt$/, '').replace(/[_-]/g, ' ');
                    content = section.trim();
                }

                // Extract date if present (format: YYYY-MM-DD)
                const dateMatch = section.match(/(\d{4}-\d{2}-\d{2})/);
                if (dateMatch) {
                    date = new Date(dateMatch[1]);
                    content = content.replace(/\d{4}-\d{2}-\d{2}/, '').trim();
                }

                if (title && content) {
                    poems.push({
                        title,
                        content,
                        date,
                        filename
                    });
                }
            });

            // Sort by date, newest first
            poems.sort((a, b) => b.date - a.date);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function renderCards() {
            const container = document.getElementById('cards-container');
            container.innerHTML = '';

            poems.forEach((poem, index) => {
                const card = document.createElement('div');
                const colorClass = `color-${(index % 10) + 1}`;
                const icon = getConsistentIcon(poem.title);
                
                card.className = `card ${colorClass}`;
                card.onclick = () => openModal(poem, colorClass);

                card.innerHTML = `
                    <div class="card-icon">${icon}</div>
                    <div class="card-title">${escapeHtml(poem.title)}</div>
                    <div class="card-content">${processContent(poem.content)}</div>
                `;

                container.appendChild(card);
            });

            // Apply masonry layout after cards are rendered
            setTimeout(masonryLayout, 100);
        }

        function masonryLayout() {
            const container = document.getElementById('cards-container');
            const cards = container.querySelectorAll('.card');
            const gap = 24;
            const screenWidth = window.innerWidth;
            
            // Mobile: use simple stacking
            if (screenWidth <= 768) {
                let currentTop = 0;
                cards.forEach(card => {
                    card.style.position = 'relative';
                    card.style.left = '0';
                    card.style.top = '0';
                    card.style.width = '100%';
                    card.style.marginBottom = '1rem';
                    currentTop += card.offsetHeight + 16;
                });
                container.style.height = 'auto';
                return;
            }

            // Desktop/Tablet: use masonry
            const cols = screenWidth <= 1024 ? 2 : 3;
            const colWidth = container.offsetWidth / cols;
            const colHeights = new Array(cols).fill(0);

            cards.forEach((card, index) => {
                const shortestCol = colHeights.indexOf(Math.min(...colHeights));
                
                card.style.position = 'absolute';
                card.style.left = `${shortestCol * colWidth}px`;
                card.style.top = `${colHeights[shortestCol]}px`;
                card.style.width = `${colWidth - gap}px`;
                card.style.marginBottom = '0';
                
                colHeights[shortestCol] += card.offsetHeight + gap;
            });

            container.style.height = `${Math.max(...colHeights)}px`;
        }

        function processContent(content) {
            // Simple HTML processing - resize images
            return content.replace(/<img([^>]*)>/gi, (match, attrs) => {
                // Add max-width style if not present
                if (!attrs.includes('style=')) {
                    return `<img${attrs} style="max-width: 100%; height: auto;">`;
                }
                return match;
            });
        }

        function getRandomIcon() {
            const icons = [
                'ðŸŒ™', 'ðŸŒŸ', 'âœ¨', 'ðŸŒ¸', 'ðŸƒ', 'ðŸŒŠ', 'ðŸ”¥', 'ðŸ’«', 'ðŸ¦‹', 'ðŸŒº',
                'ðŸŒ»', 'ðŸŒ¹', 'ðŸŒ·', 'ðŸŒ¿', 'ðŸ‚', 'ðŸŒ¾', 'â˜€ï¸', 'ðŸŒ¤ï¸', 'ðŸŒˆ', 'â­',
                'ðŸ’Ž', 'ðŸ•Šï¸', 'ðŸ¦¢', 'ðŸŒ°', 'ðŸ„', 'ðŸŒµ', 'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸŽ‹',
                'ðŸ”ï¸', 'ðŸŒ‹', 'ðŸ–ï¸', 'ðŸŒ…', 'ðŸŒ„', 'ðŸŒ‡', 'ðŸŒƒ', 'ðŸŒŒ', 'ðŸŽ­', 'ðŸŽ¨',
                'ðŸŽª', 'ðŸŽ¯', 'ðŸŽ²', 'ðŸŽ¸', 'ðŸŽ¹', 'ðŸŽµ', 'ðŸŽ¶', 'ðŸŽ¤', 'ðŸ“œ', 'ðŸ“–',
                'âœ’ï¸', 'ðŸ–‹ï¸', 'ðŸ–Šï¸', 'ðŸ“', 'ðŸ’Œ', 'ðŸ’', 'ðŸŽ', 'ðŸ—ï¸', 'ðŸ”®', 'âš¡'
            ];
            return icons[Math.floor(Math.random() * icons.length)];
        }

        function getConsistentIcon(title) {
            const icons = [
                'ðŸŒ™', 'ðŸŒŸ', 'âœ¨', 'ðŸŒ¸', 'ðŸƒ', 'ðŸŒŠ', 'ðŸ”¥', 'ðŸ’«', 'ðŸ¦‹', 'ðŸŒº',
                'ðŸŒ»', 'ðŸŒ¹', 'ðŸŒ·', 'ðŸŒ¿', 'ðŸ‚', 'ðŸŒ¾', 'â˜€ï¸', 'ðŸŒ¤ï¸', 'ðŸŒˆ', 'â­',
                'ðŸ’Ž', 'ðŸ•Šï¸', 'ðŸ¦¢', 'ðŸŒ°', 'ðŸ„', 'ðŸŒµ', 'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸŽ‹',
                'ðŸ”ï¸', 'ðŸŒ‹', 'ðŸ–ï¸', 'ðŸŒ…', 'ðŸŒ„', 'ðŸŒ‡', 'ðŸŒƒ', 'ðŸŒŒ', 'ðŸŽ­', 'ðŸŽ¨',
                'ðŸŽª', 'ðŸŽ¯', 'ðŸŽ²', 'ðŸŽ¸', 'ðŸŽ¹', 'ðŸŽµ', 'ðŸŽ¶', 'ðŸŽ¤', 'ðŸ“œ', 'ðŸ“–',
                'âœ’ï¸', 'ðŸ–‹ï¸', 'ðŸ–Šï¸', 'ðŸ“', 'ðŸ’Œ', 'ðŸ’', 'ðŸŽ', 'ðŸ—ï¸', 'ðŸ”®', 'âš¡'
            ];
            const seed = title.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
            return icons[seed % icons.length];
        }

        function openModal(poem, colorClass) {
            const modal = document.getElementById('modal');
            const modalContent = modal.querySelector('.modal-content');
            
            // Apply same color scheme to modal
            modalContent.className = `modal-content ${colorClass}`;
            
            // Use consistent icon for modal
            const modalIcon = getConsistentIcon(poem.title);
            
            document.getElementById('modal-title').innerHTML = `${modalIcon} ${poem.title}`;
            document.getElementById('modal-text').innerHTML = processContent(poem.content);
            modal.style.display = 'block';
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            const modalContent = modal.querySelector('.modal-content');
            
            // Remove color classes when closing
            modalContent.className = 'modal-content';
            modal.style.display = 'none';
        }

        // Close modal when clicking outside
        document.getElementById('modal').onclick = function(e) {
            if (e.target === this) {
                closeModal();
            }
        };

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Resize handler
        window.addEventListener('resize', () => {
            setTimeout(masonryLayout, 100);
        });

        // Load poems when page loads
        loadPoems();
    </script>
</body>
</html>